<!DOCTYPE html>
<html>
<head>
  <title>Employee App</title>
</head>
<body>
  <h2>Add / Update Employee</h2>
  <form id="empForm">
    <input type="hidden" id="empId">
    <input type="text" id="name" placeholder="Name" required>
    <input type="text" id="department" placeholder="Department" required>
    <button type="submit">Save</button>
  </form>

  <h3>Employees</h3>
  <table border="1" id="empTable">
    <thead>
      <tr><th>ID</th><th>Name</th><th>Department</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById("empForm");
    const nameInput = document.getElementById("name");
    const deptInput = document.getElementById("department");
    const empIdInput = document.getElementById("empId");
    const tableBody = document.querySelector("#empTable tbody");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = empIdInput.value;
      const name = nameInput.value;
      const department = deptInput.value;

      const payload = { name, department };
      const url = id ? `/api/employees/${id}` : "/api/employees";
      const method = id ? "PUT" : "POST";

      const res = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const result = await res.json();
      alert(id ? "Updated!" : "Added!");
      form.reset();
      loadEmployees();
    });

    async function loadEmployees() {
      const res = await fetch("/api/employees");
      const employees = await res.json();
      tableBody.innerHTML = "";
      employees.forEach(emp => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${emp.id}</td>
          <td>${emp.name}</td>
          <td>${emp.department}</td>
          <td>
            <button onclick="editEmployee(${emp.id}, \`${emp.name}\`, \`${emp.department}\`)">Edit</button>
            <button onclick="deleteEmployee(${emp.id})">Delete</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    function editEmployee(id, name, department) {
      empIdInput.value = id;
      nameInput.value = name;
      deptInput.value = department;
    }

    async function deleteEmployee(id) {
      if (confirm("Are you sure you want to delete this employee?")) {
        const res = await fetch(`/api/employees/${id}`, { method: "DELETE" });
        const result = await res.json();
        alert("Deleted!");
        loadEmployees();
      }
    }

    loadEmployees();
  </script>
</body>
</html>
